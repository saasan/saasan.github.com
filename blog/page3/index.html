<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="robots" content="noindex">
    <title>ブログ</title>
    <link href='//fonts.googleapis.com/css?family=Orbitron:500' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://slx.jp/blog/page3/">
    <link rel="alternate" type="application/rss+xml" title="saasan.github.io" href="https://slx.jp/feed.xml" />
    <link rel="apple-touch-icon" href="/img/s2works_favicon.png">
    <link rel="me" href="https://misskey.io/@saasan">
    <script data-ad-client="ca-pub-0141905477316976" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@saasan">
    <meta property="og:url" content="https://slx.jp/blog/page3/">
    <meta property="og:title" content="ブログ">
    <meta property="og:description" content="雑記、覚え書き、更新情報など">
    <meta property="og:image" content="https://slx.jp/img/s2works_favicon.png">
    <script type="application/ld+json">
      {
          "@context": "http://schema.org/",
          "@type": "Person",
          "name": "saasan",
          "sameAs": [
              "https://twitter.com/saasan",
              "https://github.com/saasan"
          ]
      }
    </script>
    <script type="application/ld+json">
      {
          "@context": "http://schema.org",
          "@type": "Article",
          "name": "ブログ",

          "headline": "雑記、覚え書き、更新情報など",
          "image": "https://slx.jp/img/s2works_favicon.png",
          "url": "https://slx.jp/blog/page3/",
          "publisher" : {
              "@type": "Person",
              "name": "saasan"
          }
      }
    </script>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="/">saasan.github.io</a>
        <nav class="site-nav">
          <div class="site-nav-contents">
            <ul>
              <li><a href="/blog/">ブログ</a></li>
              <li><a href="/imas/">アイマス</a></li>
              <li><a href="/software/">ソフトウェア</a></li>
              <li><a href="/script/">スクリプト</a></li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <div class="page-content">
      <div class="wrapper">
        <div class="post" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/WebPageElement">
          <header class="post-header">
            <h1 class="post-title">ブログ</h1>
          </header>
          <article class="post-content">
            <section>
              <h2><a class="post-link" href="/blog/2021/12/19/%E3%82%8F%E3%81%9F%E3%82%86%E3%82%8A-%E3%82%AB%E3%83%95%E3%82%A7-%E3%83%AA%E3%83%BC%E3%83%99%E5%A5%B3%E5%AD%A6%E5%9C%92-%E3%81%AE%E9%96%93%E5%8F%96%E3%82%8A%E5%9B%B3%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F.html">私の百合はお仕事です！(わたゆり)「カフェ・リーベ女学園」の間取り図を作ってみた</a></h2>
              <div class="post-meta">2021-12-19</div>
              <section>
                <p>最近「私の百合はお仕事です！」(わたゆり) にハマってます。
                  <a href="https://www.ichijinsha.co.jp/yurihime/title/%e6%9c%aa%e5%b9%a1/%e7%a7%81%e3%81%ae%e7%99%be%e5%90%88%e3%81%af%e3%81%8a%e4%bb%95%e4%ba%8b%e3%81%a7%e3%81%99%ef%bc%81/">公式サイトの紹介</a>
                  を読めば分かる通り、
                  <ruby>姉妹<rp>(</rp><rt>シュヴェスター</rt><rp>)</rp></ruby>
                  制度のある
                  <ruby>お嬢様学校<rp>(</rp><rt>ミッションスクール</rt><rp>)</rp></ruby>
                  「リーベ女学園」という設定で運営されている
                  コンセプトカフェを舞台とした作品です。</p>
                <p>ストーリーが良くて泣ける作品なのでぜひ読んでみてください。
                  登場人物全員に二面性があるので、ツンデレなどのギャップ萌え好きな人にもオススメです！
                  今なら Amazon Prime で1、2巻が読み放題になっています。</p>
                <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=saasan-22&amp;language=ja_JP&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=as_ss_li_til&amp;asins=B072KH2H5V&amp;linkId=6f19c25541d8022627fc2e8a66573385"></iframe>
                <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=saasan-22&amp;language=ja_JP&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=as_ss_li_til&amp;asins=B076F2DRBL&amp;linkId=de5dc53d2d5358c2fc09428e9729c389"></iframe>
                <p>わたゆりは上記の通り「カフェ・リーベ女学園」が舞台となっており
                  多くのシーンがその中で展開されるため、
                  その間取りが分かればさらに理解が深まるかと思い間取り図を作成してみました。</p>
                <h2 id="出典について">出典について</h2>
                <p>以下の間取り図は
                  <a href="https://www.amazon.co.jp/dp/B07878H4D9/?tag=saasan-22">Amazon Kindle の電子書籍「私の百合はお仕事です！」</a>
                  1～9巻を参考に
                  <a href="https://twitter.com/saasan">カガミ</a>
                  が作成したものです。
                  公式な情報ではありませんので、間取り図について未幡先生や一迅社へ問い合わせないでください。</p>
                <p>ページ番号については、物理書籍と合わせるためページ内記載のものとしています。
                  Kindle の Android 版アプリで表示されるロケーションは、これに1を足した数値となります。</p>
                <h2 id="間取り図">間取り図</h2>
                <p>以下が作成した間取り図です。
                  <a href="https://myhome-cloud.net/">マイホームクラウド</a>
                  で間取り図を作成したあと別のアプリで文字の追加など加工を行っています。</p>
                <p>リーベの背景は手で描かれているため、シーンによって物の大きさが異なることがあります。
                  間取り図の作成にあたっては複数のシーンを確認した上で、
                  大きな破綻がないよう一部調整しています。</p>
                <p>※2021/12/21追記: 背景は <a href="https://twitter.com/n28miman/status/1473186141684002821">途中から3Dに変更された</a> とのことです。</p>
                <p><a href="/img/blog/2021-12-19/liebe-layout.png"><img src="/img/blog/2021-12-19/liebe-layout.png" alt="「カフェ・リーベ女学園」間取り図" /></a></p>
                <h2 id="by-バックヤード">BY (バックヤード)</h2>
                <p>サロンと並び頻繁に登場する場所のため
                  大まかな配置について特に異論はないかと思います。</p>
                <h3 id="by-内の小部屋">BY 内の小部屋</h3>
                <p>BY 内にある小部屋 (※1) は作中で使用されておらず用途が分かりません。
                  壁には扉と手洗器、消毒液と思われるものが付いています。
                  扉に小窓が付いていることや (9巻120ページなど)、
                  手洗器と一緒に水周りとしてまとめられていると考えると
                  従業員用トイレでしょうか？</p>
                <h3 id="タイムレコーダー">タイムレコーダー</h3>
                <p>間取り図に入っていない要素としてタイムレコーダー (打刻機) があります。
                  時計の下にあるキャビネットの上に置かれています (2巻99ページ)。
                  また、右にある柱にタイムカード入れがあります (3巻32ページ)。
                  作中では描かれていませんが、出退勤時にここで打刻していると思われます。</p>
                <h2 id="サロン">サロン</h2>
                <p>客席は5巻3ページに描かれている引きの絵を参考に、
                  対面2席のテーブルが左右に6つずつ、計24席としました。</p>
                <p>窓側に近い客席後ろの壁に鳩時計があります。 (1巻30ページ、2巻132ページ、9巻77ページなど)</p>
                <h2 id="キッチン">キッチン</h2>
                <p>キッチン内部やデシャップから繋がる部分は
                  作中であまり描かれていないため間違っているかもしれません。</p>
                <p>BY出入口右側にコンロとシンク (5巻77～78ページ)、左側に冷蔵庫があります (3巻34ページなど)。</p>
                <p>デシャップ側から入って右側にもシンクがあります。 (1巻107ページ、5巻78ページ)</p>
                <p>冷蔵庫と横にある作業台の中間、天井から吊られている棚にモニターが付いています。 (9巻120ページ)</p>
                <h2 id="デシャップの右側にある扉">デシャップの右側にある扉</h2>
                <p>デシャップの右側にある扉 (※2) は作中で使用されておらず用途が分かりません。
                  以下の理由からお客様用トイレでしょうか？</p>
                <ul>
                  <li>飲食店のためお客様用トイレが必要</li>
                  <li>客席から近い</li>
                  <li>店の一番奥</li>
                </ul>
                <h2 id="レジ">レジ</h2>
                <p>レジはBYへ入ってすぐ左側に置かれています。
                  雰囲気を損ねないため普段見えない場所に置かれているのだと思われますが、
                  客席か受付でお客様からお金を預かってBYへ持ち込み精算するかたちでしょうか？</p>
                <p>受付で精算の場合はお金を預かってBYへ持ち込むと
                  位置的にゲストからBY内が丸見えになってしまうため、
                  客席での精算のほうが有力かも？</p>
                <h2 id="ピアノ左のテーブル">ピアノ左のテーブル</h2>
                <p>ピアノ左にあるブルーメ選挙の投票箱が置かれていたテーブルは
                  選挙後も度々描かれており常設されているようです。
                  (9巻102ページなど)</p>
                <h2 id="受付">受付</h2>
                <p>受付にはレトロ風電話機が置かれています。
                  電話予約の対応は舞が行っていると7巻シフト36.2に書かれており、
                  Web受付の状況も確認しながら対応していると考えると
                  必然的にBYで受付を行う必要があります。
                  よってレトロ風電話機は雰囲気を出すための飾りと思われます。</p>
                <p><del>実際に使えるとしても舞さん以外かけ方が分からなそう。「21世紀少女たちめ…」</del></p>
                <h2 id="出入口">出入口</h2>
                <p>出入口の扉は内側に開きます。 (5巻71ページ)</p>
                <h2 id="作中で言及されているが場所不明のもの">作中で言及されているが場所不明のもの</h2>
                <h3 id="貴重品ロッカー">貴重品ロッカー</h3>
                <p>3巻で果乃子のスマホが入れられた貴重品ロッカー。</p>
                <h3 id="物置">物置</h3>
                <p>ブルーメ選挙の投票箱が置かれている物置。
                  5巻88ページで舞が美月へ「ブルーメ選挙の投票箱を出すから見に来て」と言っています。
                  BYで「見に来て」と言っていることからBY外にあると思われます。</p>
              </section>
            </section>
            <section>
              <h2><a class="post-link" href="/blog/2021/09/18/lenovo-thinkcentre-m600-tiny%E3%81%ABpci-express%E3%82%92%E7%84%A1%E7%90%86%E3%82%84%E3%82%8A%E5%A2%97%E8%A8%AD%E3%81%99%E3%82%8B.html">Lenovo ThinkCentre M600 Tiny に PCI Express を無理やり増設する</a></h2>
              <div class="post-meta">2021-09-18</div>
              <section>
                <p>5年ほど前に組んだ自作 PC がスペック的につらくなってきたため
                  新しいものを組むことにしました。
                  PC 入れ替えにあたり、これまで1台で
                  ゲーム、開発、TV 録画などすべて行っていた状態から録画機能を切り離し、
                  録画専用 PC として分けることにしました。</p>
                <p>目的は以下のとおりです。</p>
                <ul>
                  <li>PC 交換時の録画への影響を最小限にする</li>
                  <li>ゲームなどの高負荷による録画への影響を避ける</li>
                  <li>電力消費の少ない録画用 PC を常時起動しておき、メインの PC はいつでも電源を切れるようにする</li>
                </ul>
                <h2 id="使用-pc">使用 PC</h2>
                <p>録画用 PC には、ほとんど使わないまま放置していた
                  Lenovo ThinkCentre M600 Tiny
                  を使用することにしました。
                  昨年メルカリで 15,000 円で購入したやつです。</p>
                <p>これは容積1リットルを謳う超小型デスクトップ PC で、
                  CPU は
                  <a href="https://ark.intel.com/content/www/jp/ja/ark/products/91534/intel-celeron-processor-j3060-2m-cache-up-to-2-48-ghz.html">Intel Celeron J3060</a>
                  1.6GHz 2コア、TDP 6 W となっています。</p>
                <h2 id="usb-接続の-tv-チューナーを購入したが">USB 接続の TV チューナーを購入したが…</h2>
                <p>M600 Tiny は前述の通り超小型デスクトップ PC のため、
                  今まで使用していた PCI Express (以下 PCI-E) 接続の TV チューナーボードが利用できません。
                  また、しばらくはメイン PC での録画と平行運用して様子をみたかったため、別途 USB 接続の TV チューナーを購入しました。</p>
                <p>購入後1週間ほど使用してみましたが、
                  信号がドロップしているのか
                  時々ひどいブロックノイズが入り使い物になりません。
                  これは困りました。
                  PC を変えるか USB 接続でも安定する別のチューナーが必要です。</p>
                <h2 id="pci-e-の-tv-チューナーを無理やり増設">PCI-E の TV チューナーを無理やり増設</h2>
                <p>もう1つ思いついたのが
                  今まで使用していた PCI-E 接続の TV チューナーボードを
                  無理やり M600 Tiny に取り付けるというものです。</p>
                <p>最初は PCI-E を USB に変換するものがないか探していましたが、
                  M.2 の A &amp; E キーに対応した以下の
                  M.2 → PCI-E x1 変換アダプタを見つけました。</p>
                <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=saasan-22&amp;language=ja_JP&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=as_ss_li_til&amp;asins=B07L9RFVBZ&amp;linkId=31ddd9c90c3fbc07e3d46e34298fdb14"></iframe>
                <p><a href="https://ja.wikipedia.org/wiki/M.2">M.2</a>
                  は物理的な接続方法が異なるだけで
                  PCI-E の信号をそのまま送ることができます。
                  M600 Tiny には Wi-Fi の増設用と思われる
                  E キーに対応した M.2 スロットがあるため、
                  そこにこの変換アダプタを接続すれば問題なく使用できるはずです。</p>
                <p>変換アダプタには 5 V と 12 V の電源を
                  FDD 4ピンコネクタで供給する必要があります。
                  光学ドライブなどに使用される4ピンペリフェラルコネクタから
                  FDD 4ピンコネクタへ変換するケーブルが付属していますが、
                  M600 Tiny にはどちらもありません。
                  そこで以下の変換ケーブルを購入し SATA から電源を取ることにしました。</p>
                <iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=saasan-22&amp;language=ja_JP&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=as_ss_li_til&amp;asins=B0028WIES8&amp;linkId=237de3b0f34f25bc2d854c0df081beac"></iframe>
                <p>SATA が使えなくなるため、ストレージはもともと付属していた SATA 接続の HDD をはずして M.2 の SSD にします。
                  (上記の Wi-Fi 用 M.2 とは別にもうひとつストレージ用の M.2 があります。)</p>
                <h2 id="完成">完成</h2>
                <p>変換アダプタを購入して実際に接続してみました。
                  内部は以下のようになっています。</p>
                <p><a href="/img/blog/2021-09-18/thinkcentre-tiny-pci-express1.jpg" target="_blank"><img src="/img/blog/2021-09-18/thinkcentre-tiny-pci-express1.jpg" alt="PC 内部" /></a></p>
                <p>背面の VGA (D-Sub 15 ピン) 端子が増設できる場所の板をはずして
                  ケーブルを外に出しています。</p>
                <p><a href="/img/blog/2021-09-18/thinkcentre-tiny-pci-express2.jpg" target="_blank"><img src="/img/blog/2021-09-18/thinkcentre-tiny-pci-express2.jpg" alt="ケーブルの外出し1" /></a></p>
                <p><a href="/img/blog/2021-09-18/thinkcentre-tiny-pci-express3.jpg" target="_blank"><img src="/img/blog/2021-09-18/thinkcentre-tiny-pci-express3.jpg" alt="ケーブルの外出し2" /></a></p>
                <p>最後に TV チューナーボードを取り付けて以下のようになりました。
                  PC を起動して確認しましたが問題なく認識され使用できました！</p>
                <p><a href="/img/blog/2021-09-18/thinkcentre-tiny-pci-express4.jpg" target="_blank"><img src="/img/blog/2021-09-18/thinkcentre-tiny-pci-express4.jpg" alt="TV チューナーボードの取り付け" /></a></p>
                <h2 id="まとめ">まとめ</h2>
                <p>以上のように超小型デスクトップ PC で
                  PCI-E 接続の TV チューナーボードを利用できました。</p>
                <p>Dell の Optiplex Micro も中身は似たような作りのため
                  おそらく同様に PCI-E のボードを増設できると思います。
                  HP の ProDesk DM や EliteDesk DM は中を見たことがないためわかりません。</p>
                <p>基板がむき出しのため今後ホコリへの対策を考えます。</p>
              </section>
            </section>
            <section>
              <h2><a class="post-link" href="/blog/2021/08/14/m5stack-atom-lite%E7%94%A8%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89.html">M5Stack ATOM Lite 用の開発環境構築</a></h2>
              <div class="post-meta">2021-08-14</div>
              <section>
                <p>M5StickC 1台だけだと用途ごとにプログラムを転送し直す必要があり手間がかかるので
                  ATOM Lite を購入してみた。</p>
                <p>先日 PC を変えたこともあり
                  再度 Arduino IDE での開発環境を構築する必要があったため
                  手順を備忘録として残しておく。</p>
                <p>内容は基本的に
                  <a href="https://docs.m5stack.com/en/arduino/arduino_development">m5-docs</a>
                  と同じ。
                  PC は Windows 10。</p>
                <h2 id="ドライバーと-arduino-ide-のインストール">ドライバーと Arduino IDE のインストール</h2>
                <ol>
                  <li>
                    <p>ATOM Lite を PC へ接続し、デバイスマネージャーで “USB Serial Port” が追加されているか確認。<br />
                      “M5Stack” という名前のデバイスに黄色い “！” が付いていたらドライバーがインストールされていない。</p>
                  </li>
                  <li>
                    <p>ドライバーが自動でインストールされない場合は
                      <a href="https://ftdichip.com/drivers/vcp-drivers/">VCP Drivers - FTDI</a>
                      からダウンロードしてインストール。</p>
                  </li>
                  <li>
                    <p>“USB Serial Port” が表示されたら COM の番号を覚えておく。</p>
                  </li>
                  <li>
                    <p><a href="https://www.arduino.cc/en/software">Arduino IDE</a> をダウンロードしてインストール。</p>
                  </li>
                </ol>
                <h2 id="ボードの設定">ボードの設定</h2>
                <ol>
                  <li>
                    <p>Arduino IDE を起動。</p>
                  </li>
                  <li>
                    <p>メニューの [ファイル] &gt; [環境設定] をクリック。</p>
                  </li>
                  <li>
                    <p>[追加のボードマネージャのURL] に以下を入力。</p>
                    <div class="language-plaintext highlighter-rouge">
                      <div class="highlight">
                        <pre class="highlight"><code>https://m5stack.oss-cn-shenzhen.aliyuncs.com/resource/arduino/package_m5stack_index.json
</code></pre>
                      </div>
    </div>
                  </li>
                  <li>
                    <p>[OK] をクリック。</p>
                  </li>
                  <li>
                    <p>メニューの [ツール] &gt; [ボード] &gt; [ボードマネージャ…] をクリック。</p>
                  </li>
                  <li>
                    <p>“M5Stack” で検索。</p>
                  </li>
                  <li>
                    <p>表示された “M5Stack” を [インストール]。</p>
                  </li>
                  <li>
                    <p>インストールが完了したらボードマネージャを閉じる。</p>
                  </li>
                  <li>
                    <p>メニューの [ツール] &gt; [ボード] &gt; [M5Stack Arduino] &gt;[M5Stack-ATOM] をクリック。</p>
                  </li>
                  <li>
                    <p>ウィンドウ下部に [M5Stack-ATOM] と表示されていることを確認。</p>
                  </li>
                </ol>
                <h2 id="ライブラリのインクルード">ライブラリのインクルード</h2>
                <ol>
                  <li>
                    <p>メニューの [スケッチ] &gt; [ライブラリをインクルード] &gt; [ライブラリを管理…] をクリック。</p>
                  </li>
                  <li>
                    <p>“M5Atom” で検索。</p>
                  </li>
                  <li>
                    <p>表示された “M5Atom” を [インストール]。</p>
                  </li>
                  <li>
                    <p>“Dependencies for library M5Atom” というウィンドウが表示されたら [Install all] をクリック。</p>
                  </li>
                  <li>
                    <p>インストールが完了したらライブラリマネージャを閉じる。</p>
                  </li>
                </ol>
                <h2 id="スケッチの書き込みと動作確認">スケッチの書き込みと動作確認</h2>
                <ol>
                  <li>
                    <p>メニューの [ツール] &gt; [シリアルポート] で ATOM Lite の COM 番号をクリック。</p>
                  </li>
                  <li>
                    <p>ウィンドウ下部に選択した COM 番号が表示されていることを確認。</p>
                  </li>
                  <li>
                    <p>メニューの [ファイル] &gt;  [スケッチ例] &gt; [M5Atom] &gt; [Basics] &gt; [Button] をクリック。</p>
                  </li>
                  <li>
                    <p>ツールバーの左から2番目にある右矢印か、メニューの [スケッチ] &gt;  [マイコンボードに書き込む] をクリック。 (<code class="language-plaintext highlighter-rouge">Ctrl + U</code> でも可)</p>
                  </li>
                  <li>
                    <p>“ボードへの書き込みが完了しました。” が表示されるまで待つ。</p>
                  </li>
                  <li>
                    <p>書き込みが完了したら ATOM Lite のボタンを押し LED の色が変わることを確認。</p>
                  </li>
                </ol>
                <p>以上で ATOM Lite を使う準備が整った。</p>
                <h2 id="リビルドが遅い場合の設定">リビルドが遅い場合の設定</h2>
                <p>同じスケッチで2回目以降のビルドが遅い場合は、以下のサイトを参考に設定すると良い。</p>
                <p><a href="https://hangstuck.com/arduino-buildpath-fix/">Arduino IDEのビルドを速くする｜オブジェクトファイルの出力先を固定する | ハングスタック</a></p>
              </section>
            </section>
            <section>
              <h2><a class="post-link" href="/blog/2021/05/20/slack%E3%81%B8%E9%80%9A%E7%9F%A5%E3%81%99%E3%82%8B%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88.html">Slack へ通知するシェルスクリプト</a></h2>
              <div class="post-meta">2021-05-20</div>
              <section>
                <p><a href="https://qiita.com/piroor/items/77233173707a0baa6360">プログラマーの君！ 騙されるな！ シェルスクリプトはそう書いちゃ駄目だ！！ という話 - Qiita</a>
                  を読み、シェルスクリプトで関数へ値を渡す際は
                  引数よりも標準入出力を使ったほうがシンプルに書けるようだったので、
                  以前書いた Slack へ通知メッセージを送るスクリプトを書き直してみた。</p>
                <noscript>
                  <pre>#!/bin/bash

WEBHOOK_URL=https://hooks.slack.com/services/xxxxxxxxxxx/xxxxxxxxxxx/xxxxxxxxxxxxxxxxxxxxxxxx

post_slack() {
    echo &quot;payload={\&quot;text\&quot;: \&quot;$(cat)\&quot;}&quot; | curl -s -S -X POST -d @- ${WEBHOOK_URL}
}

echo &quot;&lt;!here&gt;\nhoge\nfuga&quot; | post_slack
</pre>
                </noscript>
                <script src="https://gist.github.com/saasan/cbca2f81a3d39ea6dfa85ada5460cf33.js"></script>
                <p>post_slack では以下のかたちで処理している。</p>
                <ol>
                  <li>cat で標準入力から取り込んだ文字列を echo で結合し JSON を作成する。</li>
                  <li>それをパイプで curl へ渡す。</li>
                  <li>curl では <code class="language-plaintext highlighter-rouge">-d @-</code> で標準入力から取り込んだ文字列を POST する。</li>
                </ol>
                <p>標準入出力をパイプで繋ぐかたちとすることで、
                  以前は10行あった post_slack が3行に短縮された。</p>
              </section>
            </section>
            <section>
              <h2><a class="post-link" href="/blog/2021/04/04/m5stickc%E3%81%A7%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E6%93%8D%E4%BD%9C%E3%82%92%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%99%E3%82%8B.html">M5StickC でキーボード操作を自動化する</a></h2>
              <div class="post-meta">2021-04-04</div>
              <section>
                <p>某ゲームでアイテムを交換する作業が面倒になってきたので
                  キーボード操作を自動化したいと思った。</p>
                <p>まず思いついたのは、手元にあった
                  <a href="https://www.amazon.co.jp/dp/B004INFZEG/saasan-22">サンワサプライ製のプログラマブルテンキー NT-19UH2BK</a>。
                  久しぶりに引っぱりだして確認したところ、これは <kbd>Ctrl + C</kbd> のような同時押しには対応しているが、
                  ウェイトをはさみながら複数のキーを順次入力する用途には対応していなかった。</p>
                <p>次に <a href="https://booth.pm/ja/items/2655838">AZ-Macro</a>
                  というマクロ機能のある自作 Bluetooth キーボードキットがあることを思い出した。
                  これは ESP32 で作られていて、
                  <a href="https://github.com/palette-system/az-macro">ファームウェアのソースコードも公開</a>
                  されている。
                  手持ちの M5StickC なら同じ ESP32 が内蔵されており
                  Bluetooth にも対応しているため、目的を実現できるのではないか？</p>
                <p>ということで、M5StickC を Bluetooth キーボードとして PC へ接続し操作を自動化する。</p>
                <h2 id="arduino-ide-へ-esp32-ble-keyboard-をインストール">Arduino IDE へ ESP32-BLE-Keyboard をインストール</h2>
                <p>まずは M5StickC を Bluetooth キーボードとして使うためのライブラリを
                  Arduino IDE へインストールする。</p>
                <ol>
                  <li><a href="https://github.com/T-vK/ESP32-BLE-Keyboard/releases">Releases · T-vK/ESP32-BLE-Keyboard</a>
                    から ESP32-BLE-Keyboard.zip をダウンロード</li>
                  <li>Arduino IDE のメニューで [スケッチ] - [ライブラリをインクルード] - [.ZIP形式のライブラリをインストール…] をクリック</li>
                  <li>さきほどダウンロードした ESP32-BLE-Keyboard.zip を選択</li>
                </ol>
                <h2 id="esp32-ble-keyboard-の使い方">ESP32-BLE-Keyboard の使い方</h2>
                <p><a href="https://github.com/T-vK/ESP32-BLE-Keyboard/blob/master/examples/SendKeyStrokes/SendKeyStrokes.ino">公式のサンプル</a>
                  を見れば大まかな使い方はわかると思うが、メソッドの説明がないので補足しておく。</p>
                <p>BleKeyboard クラスの以下のメソッドでキーを操作できる。</p>
                <ul>
                  <li>print: 文字列を入力</li>
                  <li>write: キーを押してすぐに離す</li>
                  <li>press: キーを押す (release するまで押したままにする)</li>
                  <li>release: キーを離す</li>
                  <li>releaseAll: すべてのキーを離す</li>
                </ul>
                <p>キーの指定は、英数記号の場合、文字をそのまま渡す。
                  大文字を渡すと自動でシフトキーが補完され大文字での入力になる。</p>
                <div class="language-plaintext highlighter-rouge">
                  <div class="highlight">
                    <pre class="highlight"><code>bleKeyboard.write('a');
</code></pre>
                  </div>
                </div>
                <p>ファンクションキー、修飾キーなどの場合は
                  <a href="https://github.com/T-vK/ESP32-BLE-Keyboard/blob/master/BleKeyboard.h">BleKeyboard.h</a>
                  で定義されている定数を渡す。</p>
                <h2 id="スケッチの作成">スケッチの作成</h2>
                <p>M5StickC のボタンA (正面の「M5」ボタン) を押すと
                  500ms 間隔で順番に B, L, E, Enterキーを押すサンプルスケッチを作成した。
                  今回は同時押しが不要だったため
                  keystroke に書かれたキーを順に write で出力するだけとなっている。</p>
                <noscript>
                  <pre>#include &lt;vector&gt;
#include &lt;M5StickC.h&gt;
#include &lt;BleKeyboard.h&gt;

// -----------------------------------------------------------------------------
// 定数
// -----------------------------------------------------------------------------
// 電源ボタンが1秒未満押された
const uint8_t AXP_WAS_PRESSED = 2;
// キーと待ち時間の構造体
struct Key {
  uint8_t key;
  uint32_t delay;
};
// 送信するキーストローク
const std::vector&lt;Key&gt; keystroke = {
    { &#39;B&#39;       , 500 },
    { &#39;L&#39;       , 500 },
    { &#39;E&#39;       , 500 },
    { KEY_RETURN, 0 }
};

// -----------------------------------------------------------------------------
// 変数
// -----------------------------------------------------------------------------
// ESP32-BLE-Keyboard
BleKeyboard bleKeyboard;

// -----------------------------------------------------------------------------
// 関数
// -----------------------------------------------------------------------------
// 画面を消去する
void clearScreen() {
    M5.Lcd.fillScreen(TFT_BLACK);
    M5.Lcd.setCursor(0, 0);
}

// キーストロークを送信する
void sendKeystroke() {
    clearScreen();
    M5.Lcd.println(&quot;Sending...&quot;);

    for (const auto&amp; n : keystroke) {
        bleKeyboard.write(n.key);
        delay(n.delay);
    }

    M5.Lcd.println(&quot;Complete!&quot;);
}

void setup() {
    M5.begin();

    // 画面の表示設定
    M5.Lcd.setRotation(1);
    M5.Lcd.setTextFont(2);
    clearScreen();
    M5.Lcd.println(&quot;ESP32-BLE-Keyboard&quot;);

    // Bluetooth接続
    bleKeyboard.begin();
}

void loop() {
    M5.update();

    // 電源ボタンが押されたらリセット
    if (M5.Axp.GetBtnPress() == AXP_WAS_PRESSED) {
        esp_restart();
    }

    if (bleKeyboard.isConnected()) {
        // Bluetooth接続済みの場合
        // ボタンAが押されたらキーを送信
        if (M5.BtnA.wasPressed()) {
            sendKeystroke();
        }

        delay(10);
    }
    else {
        // Bluetooth未接続の場合は5秒待つ
        M5.Lcd.println(&quot;Waiting 5 seconds...&quot;);
        delay(5000);
    }
}
</pre>
                </noscript>
                <script src="https://gist.github.com/saasan/95c34469ebd1186c12398fbeb8266d17.js"></script>
                <h2 id="動作確認">動作確認</h2>
                <p>以下の手順で動作を確認できる。</p>
                <ol>
                  <li>M5StickC にスケッチを書き込む</li>
                  <li>M5StickC の画面に “Waiting 5 seconds…” と表示されていることを確認</li>
                  <li>PC で Bluetooth デバイスを検索し “ESP32 BLE Keyboard” へ接続</li>
                  <li>メモ帳などのアプリを開く</li>
                  <li>M5StickC のボタンA (正面の「M5」ボタン) を押す</li>
                </ol>
                <p>これで複雑なキーボードマクロでも思い通りに実行できるようになった。
                  キーボードでできることなら何でもボタン一発で実行できるため、
                  思っていた以上に利便性が高い。</p>
                <h2 id="参考サイト">参考サイト</h2>
                <ul>
                  <li><a href="https://neocat.hatenablog.com/entry/2019/09/28/151947">ESP32をBluetoothキーボードやマウスにする - Okiraku Programming</a></li>
                  <li><a href="https://github.com/T-vK/ESP32-BLE-Keyboard">T-vK/ESP32-BLE-Keyboard: Bluetooth LE Keyboard library for the ESP32 (Arduino IDE compatible)</a></li>
                </ul>
              </section>
            </section>
            <div class="pagination">
              <a href="/blog/page2/">&laquo; 前のページ</a>
              <a href="/blog/page2/">1</a>
              <a href="/blog/page2/">2</a>
              <em>3</em>
              <a href="/blog/page4/">4</a>
              <a href="/blog/page5/">5</a>
              <a href="/blog/page6/">6</a>
              <a href="/blog/page7/">7</a>
              <a href="/blog/page4/">次のページ &raquo;</a>
            </div>
          </article>
        </div>
      </div>
    </div>
    <footer class="site-footer">
      <div class="wrapper">
        <nav>
          <ul>
            <li><a href="/blog/">ブログ</a></li>
            <li><a href="/imas/">アイマス</a></li>
            <li><a href="/software/">ソフトウェア</a></li>
            <li><a href="/script/">スクリプト</a></li>
          </ul>
          <a href="https://twitter.com/saasan" target="_blank" class="twitter-username">
            saasan
          </a>
          <a href="/feed.xml" target="_blank" class="rss">RSS</a>
        </nav>
      </div>
    </footer>
  </body>
</html>
